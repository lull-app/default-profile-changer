<!DOCTYPE html>
<html>
  <head lang="en">
    <title>Default Profile Changer Settings</title>
    <meta charset="utf-8" />
    <script src="https://sdpi-components.dev/releases/v3/sdpi-components.js"></script>
  </head>

  <body>
    <sdpi-item label="Select Profile">
      <sdpi-select
        id="profileSelect"
        setting="newDefaultProfile"
        placeholder="Choose a profile"
      >
        <!-- Options will be dynamically added here -->
      </sdpi-select>
    </sdpi-item>

    <script>
      const { streamDeckClient } = SDPIComponents;

      // Function to update the dropdown
      function updateDropdown(profiles) {
        const selectElement = document.getElementById("profileSelect");

        // Clear existing options
        selectElement.innerHTML = '<option value="">Choose a profile</option>';

        // Add new options
        profiles.forEach((profile) => {
          const option = document.createElement("option");
          option.value = profile;
          option.textContent = profile;
          selectElement.appendChild(option);
        });
      }

      // Fetch settings when the Property Inspector loads
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          const settings = await streamDeckClient.getSettings();
          if (settings?.profiles) {
            updateDropdown(settings.profiles);
          }
        } catch (error) {
          console.error("Failed to get settings:", error);
        }
      });
    </script>
  </body>
</html>
