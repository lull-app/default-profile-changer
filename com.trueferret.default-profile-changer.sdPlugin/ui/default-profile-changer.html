<!DOCTYPE html>
<html>
  <head lang="en">
    <title>Default Profile Changer Settings</title>
    <meta charset="utf-8" />
    <script src="https://sdpi-components.dev/releases/v3/sdpi-components.js"></script>
  </head>

  <body>
    <sdpi-item label="Select Profile">
      <sdpi-select
        id="profileSelect"
        setting="newDefaultProfile"
        placeholder="Choose a profile"
      >
        <!-- Options will be dynamically added here -->
      </sdpi-select>
    </sdpi-item>

    <sdpi-item label="Status" type="info">
      <div id="statusMessage">Loading profiles...</div>
    </sdpi-item>

    <sdpi-item label="Refresh Profiles">
      <sdpi-button id="refreshButton">Refresh Profiles</sdpi-button>
    </sdpi-item>

    <script>
      const { streamDeckClient } = SDPIComponents;

      // Function to update the dropdown menu
      function updateDropdown(profiles) {
        const selectElement = document.getElementById("profileSelect");

        // Clearing the existing options
        selectElement.innerHTML = `<option value="">Choose a profile</option>`;

        // Adding the options
        if (profiles && profiles.length > 0) {
          profiles.forEach((profileName) => {
            const option = document.createElement("option");
            option.value = profileName;
            option.textContent = profileName;
            selectElement.appendChild(option);
          });
          statusMessage.textContent = `${profiles.length} profiles loaded`;
        } else {
          statusMessage.textContent = "No profiles found";
        }
      }

      // For Fetching settings when the Property Inspector loads
      document.addEventListener("DOMContentLoaded", async function () {
        try {
          const settings = await streamDeckClient.getGlobalSettings();

          if (settings && settings.profiles && settings.profiles.length > 0) {
            updateDropdown(settings.profiles);
            
            /** in the future this will be fiksed
            if (settings.newDefaultProfile) {
              document.getElementById("profileSelect").value = settings.newDefaultProfile;
            }
            */
          } else {
            statusMessage.textContent = "Loading Profiles...";
          }
        } catch (error) {
          statusMessage.textContent =
            "Error loading settings: " + error.message;
        }
      });
    </script>
  </body>
</html>
